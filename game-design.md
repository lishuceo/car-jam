# 停车场管理 3D 游戏设计文档

## 游戏概述

《停车场管理 3D》是一款基于Three.js开发的3D益智游戏，玩家需要管理一个停车场，通过点击控制车辆行驶，合理利用临时停车位，并确保乘客能按颜色匹配上车，最终目标是让所有车辆顺利离开停车场。

## 核心游戏机制

### 车辆系统
- 车辆有不同的座位数：2座、4座、6座、8座、10座
- 所有车辆都是单排双座设计（即一行两个座位）
- 车辆座位数决定了车辆的长度（2座=1格、4座=2格、6座=3格、8座=4格、10座=5格）
- 车辆顶部有可见的座位表示，清晰展示其容量
- 车辆只有装满与自身颜色相同的乘客后才能离开停车场
- 玩家点击车辆后，车辆会自动向车头方向行驶，直到遇到障碍物或到达停车场边缘
- 车辆到达停车场边缘时，会自动寻找并驶入可用的临时停车位（只有当存在空闲的临时停车位时才会自动移入）
- 每辆车都有明确的车头和车尾区分，车辆只能向车头方向行驶
- 车头设计优化：添加了锥形车头、黄色车灯和顶部红色方向箭头，使车辆行驶方向一目了然

### 乘客系统
- 游戏场景外有一个乘客队列，乘客有不同的颜色
- 乘客以3D模型形式在场景中排队等候
- 停在临时停车位的车辆可以接载与自己颜色相匹配的乘客
- 车辆必须坐满乘客（乘客数量等于车辆座位数）才能离开
- 乘客按队列顺序上车，只能上与自己颜色相匹配的车辆

### 临时停车位
- 每个关卡有固定数量的临时停车位
- 车辆必须先进入临时停车位，才能接载乘客并最终离开
- 临时停车位被占满且没有车能离开时，游戏失败

### 胜利与失败条件
- 胜利条件：所有车辆都成功离开停车场
- 失败条件：临时停车位全部被占用，且没有车辆满员可以离开，而队列中还有乘客等待

## 游戏界面

### 3D场景
- 8×8网格游戏区域，使用Three.js渲染
- 有明确的停车场边界和临时停车位标记
- 车辆有明显的前后区分，包括车头指示、车窗和轮子
- 车顶有座位表示，展示车辆容量

### 用户界面
- 临时停车位状态显示：显示各停车位的占用情况和车辆颜色
- 乘客队列显示：展示待乘坐的乘客颜色和顺序
- 关卡信息：当前关卡编号和移动次数统计
- 控制按钮：重置、上一关、下一关
- 胜利/失败提示：游戏结束时的状态提示

## 关卡设计

游戏包含6个预设关卡，每个关卡的难度逐渐增加：
- 第一关：2座和4座车辆为主，临时停车位3个
- 第二关：4座和6座车辆为主，临时停车位2个
- 第三关：4座和6座车辆，临时停车位4个，更复杂布局
- 第四关：4座和6座车辆，更密集的车辆布局，临时停车位3个
- 第五关：4座和6座车辆，复杂的垂直和水平车辆组合，临时停车位2个
- 第六关：增加8座和10座大型车辆，更高难度挑战，临时停车位3个

每个关卡的车辆座位数和乘客队列相对应，确保玩家需要战略性规划车辆移动顺序。

## 车辆类型详解

### 座位系统
- **2座车辆**：占据1格空间，需要2名乘客满载
- **4座车辆**：占据2格空间，需要4名乘客满载
- **6座车辆**：占据3格空间，需要6名乘客满载
- **8座车辆**：占据4格空间，需要8名乘客满载
- **10座车辆**：占据5格空间，需要10名乘客满载

### 视觉设计
- 车顶有明显的座位标记，数量对应座位数
- 座位采用黑色材质，与车身颜色形成对比
- 车辆长度随座位数增加而增加
- 车身宽度保持统一（1格）

### 游戏策略
- 小型车辆（2座/4座）机动性好，但效率低
- 大型车辆（8座/10座）效率高但难以操作，占用更多空间
- 玩家需要在车辆大小和灵活性间做出平衡

## 交互设计

### 玩家操作
- 点击车辆：车辆向前行驶直到遇到障碍或到达边缘
- 点击重置按钮：重新开始当前关卡
- 点击上一关/下一关按钮：切换关卡
- 使用鼠标滚轮或右键拖动：旋转和缩放场景视角

### 视觉反馈
- 满载乘客的车辆会显示黄色发光效果
- 临时停车位有明显的标记
- 游戏结束时会显示胜利或失败的提示信息

## 技术实现

### 开发环境
- 使用Three.js进行3D渲染
- HTML5/CSS/JavaScript开发
- 响应式设计，适配不同设备屏幕

### 核心算法
- 网格系统表示停车场和车辆位置
- 碰撞检测与移动限制逻辑
- 乘客分配和匹配系统
- 胜利与失败条件检测

## 优化与扩展

### 已实现优化
- 修复了当车辆前方有障碍物时点击可能导致车辆消失的bug
- 修复了车辆碰撞检测逻辑，确保车辆不会重叠，每步移动都进行碰撞检测
- 增强了碰撞检测算法，解决不同方向车辆之间的重叠问题
- 修复了3D模型渲染位置与逻辑网格位置不匹配的问题，确保视觉呈现与碰撞检测一致
- 优化了车辆外观，增加了锥形车头、车灯和方向箭头，使方向更加明显
- 添加了车顶座位标记，更直观地展示车辆容量

### 未来扩展计划
- 增加更多关卡，逐步引入更复杂的车辆和场景布局
- 添加特殊车辆类型（如可搭载不同颜色乘客的共享车）
- 实现关卡编辑器，允许玩家创建自定义关卡
- 增加计时和评分系统，鼓励玩家优化解法

## 游戏特色

### 关卡设计
- 初级关卡：较少车辆和乘客，简单布局
- 中级关卡：更多车辆和乘客种类，受限的临时停车位
- 高级关卡：复杂布局，需要精确规划和前瞻性思考
- 极限挑战：特殊规则关卡（计时、步数限制、乘客随机出现等）

### 车辆类型
1. **小型轿车**：占据2格，可搭载2名乘客
2. **中型车辆**：占据3格，可搭载3名乘客  
3. **特殊车辆**：拥有特殊属性的车辆（高级关卡）
   - 共享车：可搭载不同颜色乘客
   - 快车：离开速度更快（节省临时停车位）

### 乘客类型
1. **普通乘客**：有固定颜色，只能坐对应颜色车辆
2. **特殊乘客**（高级关卡）：
   - VIP乘客：优先上车，但需要特定车型
   - 灵活乘客：可乘坐任意颜色车辆

### 进阶元素
- **动态乘客队列**：乘客队列可能随游戏进行而变化
- **时间限制**：某些乘客有等待时间限制，超时会导致失败
- **停车位规则**：某些临时停车位有特定规则（如只允许特定颜色车辆）
- **特殊事件**：随机出现的特殊事件增加游戏变数

## 游戏模式

### 故事模式
- 包含150+精心设计的关卡，难度渐进
- 分为多个场景（商业区、住宅区、景点等）
- 解锁特殊车辆和能力
- 星级评价系统（基于步数、时间）

### 每日挑战
- 每天更新一个特殊设计的难题
- 全球排行榜比较解决时间和步数
- 连续完成挑战获得特殊奖励

### 自定义关卡
- 关卡编辑器允许玩家创建自己的难题
- 社区分享和评价系统
- 可挑战好友创建的关卡

### 急难模式
- 持续增加的车辆和乘客
- 临时停车位数量有限
- 生存时间越长分数越高

## 视觉与音效设计

### 美术风格
- 简约清晰的现代城市风格
- 车辆设计各具特色，清晰展示车头车尾
- 乘客使用简单人形图标，颜色醒目
- 动画流畅，移动感强，有满足感

### 颜色系统
- 使用明确区分的颜色方案（红、蓝、绿、黄、紫等）
- 车辆和对应乘客颜色一致
- 临时停车位有明显的标识和状态变化

### 音效
- 轻松欢快的背景音乐，不同场景变化
- 互动音效反馈（移动、上车、离开等）
- 音效设计符合各种车辆特点和游戏事件

## 进度与奖励系统

### 游戏内货币
- 通过完成关卡、挑战和成就获得星星/金币
- 用于解锁新车辆、乘客类型和特殊关卡

### 成就系统
- 多种成就类型（效率、精确度、完美运营等）
- 阶段性里程碑奖励
- 特殊挑战成就（如"不使用特定临时停车位完成关卡"）

### 解锁系统
- 新场景和主题需要收集足够星星解锁
- 特殊车辆和乘客类型通过完成特定任务获得
- 高级关卡需要一定进度才能进入

## 技术实现

### 开发环境
- 使用HTML5/CSS/JavaScript开发
- 响应式设计，适配不同设备屏幕
- Canvas或SVG渲染游戏界面

### 核心算法
- 网格系统表示停车场和车辆位置
- 碰撞检测与移动限制逻辑
- 乘客分配和匹配系统
- 胜利与失败条件检测

### 数据存储
- 本地存储保存游戏进度
- 云存储同步（如使用账户系统）
- 关卡数据结构优化

## 用户界面

### 主界面
- 清晰的关卡选择地图
- 进度和成就展示
- 设置和帮助入口

### 游戏内界面
- 停车场网格区域
- 临时停车位区域（显示状态和容量）
- 乘客队列区域
- 步数和计时器
- 撤销和重置按钮

### 辅助功能
- 颜色盲模式（使用不同图案区分车辆和乘客）
- 可调整控制灵敏度
- 教程模式帮助新手入门

## 营销与变现

### 免费增值模式
- 基础游戏免费，包含有限关卡
- 通过广告获得额外提示或生命
- 购买完整版解锁全部内容

### 内购选项
- 关卡包和主题场景
- 特殊车辆和乘客类型
- 无广告体验

### 社交分享
- 分享成就和记录到社交媒体
- 邀请好友解锁特殊内容
- 好友排行榜增加竞争性

## 扩展计划

### 未来更新路线图
- 季节性主题和活动
- 多人模式（协作或竞争）
- AR增强现实模式

### 跨平台计划
- 移动平台优先
- 后续PC和网页版
- 可能的主机版本

## 游戏平衡

### 难度曲线
- 精心设计的难度递进，避免陡峭跳跃
- 在新机制引入前提供足够练习
- 定期插入简单关卡提供成就感

### 测试计划
- 早期原型测试核心玩法
- 封闭测试评估难度平衡
- 开放测试收集用户反馈

### 教程设计
- 直观的引导式教程
- 逐步介绍游戏机制
- 情境式提示而非强制教学

## 结语

《停车场管理 3D》通过创新的座位系统和乘客匹配机制，为经典的停车场解谜游戏增添了全新的策略深度。游戏易于上手但难以精通，适合各个年龄段的休闲玩家和益智游戏爱好者。
